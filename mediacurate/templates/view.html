{%extends "base.html"%}
{% load tagging_tags %}
{% load comments %}
{% load humanize %}

{%block title%}{%if title%}{{title}}{%else%}{{media.title}}{%endif%}{%endblock%}

{%block content%}

{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message|safe }}</li>
    {% endfor %}
</ul>
{% endif %}

{% if media %}
<h1 id="mediatitle">
  {{media.title}}
</h1>

<div id="embed">
{{media.embed.html|safe}}
</div>

<p id="attribution">
	<a href="/search?location={{media.location.name|urlencode}}">{{media.location}}</a>. Originally posted on <a href="{{media.embed.response.original_url}}">{{media.embed.response.provider_name}}</a> by <a href="{{media.author_url}}">{{media.author_name}}</a>
</p>
<ul id="votebuttons">
  <li><a href="/view/vote/{{media.id}}/1/" class="upvote">Vote</a><span class="votes">{{media.total_upvotes}}</span></li>
  <li><a href="/flag/{{media.id}}/" class="flag">Flag</a></li>
</ul>
<div id="info">
  	<span class="label">Tags:</span>
	{% tags_for_object media as tags %}
	<ul class="tags">
		{%for tag in tags %}
		<li class="tag"><a href="/search?tag={{tag}}">{{tag}}</a></li>
    	{%endfor%}
	</ul>
	<form action="/tag/{{media.id}}/" id="add_tags">
		{% csrf_token %}
		<input id="id_tags" />
		<input id="tag_submit" type="submit" value="add tag" />
	</form>
</div>

<div id="reviews" class="group">
  {% render_comment_list for media %}
  
  <span class="label">Add your own review:</span>
  {% render_comment_form for media %}
</div>
{%else%}
<h1>Nothing yet, add the first video</h1>
{%endif%}
{%endblock%}

{%block aside %}

<ul class="tabs group">
{%for tab in tabs%}
	<li class="tab">
		<h3><a href="#{{tab.name|slugify}}">{{tab.name}}</a></h3>
	</li>
{%endfor%}
</ul>
<div class="slide group">
{%for tab in tabs%}
  <ul id="{{tab.name|slugify}}" class="group">
    {%for media in tab.list %}
    <li class="group">
  	  <a href="{{media.get_absolute_url}}"><img src="{{media.embed.response.thumbnail_url}}" width="100"></a>
  	  <h4><a href="{{media.get_absolute_url}}">{{media.title}}</a></h4>
  	  <div class="info">{%if media.views%}<span class="media_views">{{media.views|intcomma}} view{{media.views|pluralize}}</span>{%endif%}
  	  					<span class="media_upvotes">{{media.total_upvotes}} vote{{media.total_upvotes|pluralize}}</span>
  	  					<br><span class="media_dateadded">added {{media.date_added}}</span>
  	  </div>
  	</li>
  	{%empty%}
  	<p class="noresults">Nothing yet: check back later, or add more.</p>
  	{%endfor%}
  	<a href="{{tab.view_all_link}}" class="view_all">View all</a>
  </ul>
{%endfor%}
</div>

{%endblock%}